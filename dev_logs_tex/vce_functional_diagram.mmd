%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e3f2fd', 'secondaryColor': '#f3e5f5', 'tertiaryColor': '#e8f5e9'}}}%%
flowchart LR
%% VCE（Video Chapter Editor）機能図
%% リポジトリ（media-scribe-workflow）の目的: メディアの再利用性・相互運用性向上
%%
%% 2軸モデル
%%   縦軸（Y）: 時間・状態変化・目的
%%   横軸（X）: 目的 → 手段（What → How → Who）
%%
%%   コンテンツ（What）: 処理対象のデータ、状態
%%   処理（How）: 状態を変化させる機能
%%   実装（Who）: 処理を担当するクラス

%% ============================================================
%% コンテンツ層（What: 何を処理するか）
%% 縦方向 = 時間・状態変化
%% ============================================================
    subgraph Layer_Content["コンテンツ<br>（What）"]
        direction TB
        C_Input(("入力<br>MP4/MP3"))
        C_SourceFile(("SourceFile"))
        C_Chapter(("Chapter"))
        C_Project((".vce.json"))
        C_Output(("出力<br>MP4/MP3"))

        C_Input --> C_SourceFile
        C_SourceFile --> C_Chapter
        C_Chapter --> C_Project
        C_Project --> C_Output
    end

%% ============================================================
%% 処理層（How: どう変化させるか）
%% ============================================================
    subgraph Layer_Process["処理<br>（How）"]
        direction TB

        subgraph PG_Input["入力"]
            P_Classify{{"分類"}}
            P_Load{{"読込"}}
        end

        subgraph PG_Edit["編集"]
            P_Add{{"追加"}}
            P_Remove{{"削除"}}
            P_ChapterEdit{{"章編集"}}
            P_Exclude{{"除外"}}
        end

        subgraph PG_Persist["永続化"]
            P_Save{{"保存"}}
            P_LoadProj{{"読込"}}
        end

        subgraph PG_Export["出力"]
            P_Normalize{{"正規化"}}
            P_Encode{{"変換"}}
            P_Split{{"分割"}}
        end

        PG_Input --> PG_Edit
        PG_Edit --> PG_Persist
        PG_Persist --> PG_Export
    end

%% ============================================================
%% 実装層（Who: 誰が担当するか）
%% ============================================================
    subgraph Layer_Impl["実装<br>（Who）"]
        direction TB
        M_Source["SourceFileManager"]
        M_Play["PlaybackManager"]
        M_Chapter["ChapterManager"]
        M_Export["ExportOrchestrator"]

        M_Source --- M_Play
        M_Play --- M_Chapter
        M_Chapter --- M_Export
    end

%% ============================================================
%% 横方向フロー: What → How → Who
%% ============================================================
    %% 入力フェーズ
    C_Input --> P_Classify
    P_Classify --> M_Source
    P_Load --> M_Source

    %% 編集フェーズ
    C_SourceFile --> P_Add
    C_SourceFile --> P_Remove
    C_Chapter --> P_ChapterEdit
    C_Chapter --> P_Exclude
    P_Add --> M_Source
    P_Remove --> M_Source
    P_ChapterEdit --> M_Chapter
    P_Exclude --> M_Chapter

    %% 永続化フェーズ
    C_Project --> P_Save
    C_Project --> P_LoadProj
    P_Save --> M_Chapter
    P_LoadProj --> M_Chapter

    %% 出力フェーズ
    C_Output --> P_Encode
    C_Output --> P_Split
    P_Normalize --> M_Export
    P_Encode --> M_Export
    P_Split --> M_Export

%% ============================================================
%% スタイル定義
%% ============================================================
    classDef contentNode fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef processNode fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef implNode fill:#e1bee7,stroke:#6a1b9a,stroke-width:2px

    class C_Input,C_SourceFile,C_Chapter,C_Project,C_Output contentNode
    class P_Classify,P_Load,P_Add,P_Remove,P_ChapterEdit,P_Exclude,P_Save,P_LoadProj,P_Normalize,P_Encode,P_Split processNode
    class M_Source,M_Play,M_Chapter,M_Export implNode
