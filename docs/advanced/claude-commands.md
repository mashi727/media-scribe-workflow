# Claude Code コマンド設定

Claude Codeでリハーサル記録作成を効率化するためのカスタムコマンド設定方法です。

## 概要

Claude Codeでは、スラッシュコマンド（`/rehearsal`など）を定義して、
複雑なプロンプトを簡単に呼び出すことができます。

## コマンドの配置

### プロジェクトローカル

```
rehearsal-workflow/
└── claude/
    └── commands/
        └── rehearsal.md
```

プロジェクトディレクトリ内の `claude/commands/` に配置すると、
そのプロジェクトで作業中にコマンドが利用可能になります。

### グローバル

```
~/.claude/commands/
└── rehearsal.md
```

ホームディレクトリの `~/.claude/commands/` に配置すると、
すべてのプロジェクトでコマンドが利用可能になります。

## コマンドファイルの形式

### 基本構造

```markdown
# コマンドタイトル

コマンドの説明と詳細なプロンプト...

## セクション1

詳細な指示...

## セクション2

さらに詳細な指示...
```

### 変数の使用

```markdown
# テンプレート例

以下のファイルを分析してください：
- ファイル: {{filename}}
- 言語: {{language|ja}}

{{filename}} の内容を...
```

- `{{変数名}}` - 必須変数（実行時に入力を求められる）
- `{{変数名|デフォルト値}}` - オプション変数

## rehearsal コマンドの使用方法

### 1. 事前準備

```bash
# 動画と字幕のダウンロード
rehearsal-download "https://youtu.be/VIDEO_ID"

# Whisper完了を待機（*_wp.srt が生成されるまで）
```

### 2. Claude Code 起動

```bash
# 作業ディレクトリで起動
cd /path/to/work/directory
claude code
```

### 3. コマンド実行

```
/rehearsal
```

### 4. 対話的な情報入力

Claude が以下の情報を質問します：

1. 処理対象ファイル
   - YouTube字幕（`*_yt.srt`）
   - Whisper字幕（`*_wp.srt`）

2. リハーサル基本情報
   - 日付
   - 団体名
   - 指揮者名
   - 曲目
   - 本番日程

3. レポート作成者
   - 著者名
   - 視点（例：ホルンセクション）

### 5. 出力

LuaTeX形式のリハーサル記録ファイルが生成されます：

```
20251102_ドヴォルザーク交響曲第8番_リハーサル記録.tex
```

## カスタムコマンドの作成

### 例：簡易版リハーサル記録

```markdown
# 簡易リハーサル記録

字幕ファイルを分析し、Markdown形式の簡易リハーサル記録を作成してください。

## 入力

- 字幕ファイル: {{srt_file}}

## 出力形式

Markdown形式で以下を含む：
- リハーサル概要
- 時系列の指示記録（タイムスタンプ付き）
- 重要な指示のまとめ

## 注意点

- 誤認識を文脈から修正
- 音楽用語は正確な表記に
- タイムスタンプは [HH:MM:SS] 形式
```

### 例：チャプター生成

```markdown
# チャプター生成

字幕ファイルからYouTubeチャプター形式のリストを生成してください。

## 入力

- 字幕ファイル: {{srt_file}}

## 出力形式

```
00:00:00 オープニング
00:05:30 第1楽章の練習開始
00:15:45 練習番号A
...
```

## 基準

- 曲の開始・終了
- 練習番号の変更
- 重要な指示のあった時点
```

## トラブルシューティング

### コマンドが認識されない

```bash
# ファイルの配置確認
ls -la claude/commands/
ls -la ~/.claude/commands/

# Claude Code 再起動
# Ctrl+C で終了後、再度起動
```

### 変数が展開されない

```markdown
# 正しい形式
{{variable}}

# 間違い
{{ variable }}  # スペースが入っている
{variable}      # 中括弧が1つ
```

## ベストプラクティス

1. **明確な構造化**
   - セクションを使って指示を整理
   - 箇条書きで要件を列挙

2. **具体的な例の提供**
   - 入力例と出力例を含める
   - 望ましい形式を明示

3. **制約条件の明記**
   - 出力形式（Markdown, LaTeX等）
   - ファイル命名規則
   - 必須のセクション

4. **エラーケースの考慮**
   - ファイルが見つからない場合
   - 字幕の品質が低い場合

## 関連

- [my-setup.md](my-setup.md) - 全体構成
- [claude/commands/rehearsal.md](../../claude/commands/rehearsal.md) - 実際のコマンドファイル
- [examples/prompts/](../../examples/prompts/) - プロンプト例
